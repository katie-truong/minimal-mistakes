---
layout: single
title: "How Twitter users reacted to Brexit"
description: "My attempt to use the TwitteR and qdap packages in tweet analysis"
category: R
tags: [r, brexit, twitter, data analysis, politics, TwitteR, qdap]
comments: true
---

"What do you think about Brexit?" asked the interviewer, in my very first job interview in Vietnam, on June 24, 2016. Being unplugged from the Internet for 18 hours on the airplane from US to Vietnam, and another 12 hours of sleep due to jetlag, I was stunned. Being so unexpected as it was, Brexit cost me a job offer. However, also being hugely popular and polarized, it gives me a great opportunity to practice text mining and sentimental analysis. In this very first post, I would demonstrate the process of using the `TwitteR` and `tm` packages to mine and analyze Twitter users' reactions to Brexit on the day June 24, 2016, the very day Brexit happened.

## Getting the data

The process of mining tweets is indeed straightforward, thanks to the awesome `TwitteR` package. However, the prepration is somewhat cumbersome, which I would demonstrate in another post. The goal is get **Consumer Key**, **Consumer Secret**, **Access Token** and **Access Token Secret**, in order for the `setup_twitter_oauth` function to work. 

After setting up authentication, the real process of mining tweets would be fairly easy with only function `searchTwitter` needed, and `twListToDF` in case you want to convert the results to a data frame. 

Let's assume **Consumer Key**, **Consumer Secret**, **Access Token** and **Access Token Secret** be **A**, **B**, **C** and **D** respectively (the real keys and secrets would be series of multiple characters and numbers), the process of getting 10,000 tweets with hashtag **#Brexit** on June 24, 2016 would be:

```r
library(twitteR)

consumer_key = 'A'
consumer_secret = 'B'
access_token = 'C'
access_secret = 'D'

setup_twitter_oauth(consumer_key, consumer_secret, access_token, access_secret)

# Scrape the data, 10000 tweets, language = English
brexit = searchTwitter("#Brexit", n = 50000, since = "2016-06-23", until = "2016-06-24", lang = "en")
brexit = twListToDF(brexit)
```

## Cleaning the data

One important character of tweets is that they contain a lot of emojis, in the form of `latin1` characters, which would be incompatible with the `qdap` package. To eliminate that problem, I convert all characters in the form of `latin1` to `ASCII`.

```r
brexit$text = iconv(brexit$text, "latin1", "ASCII", sub="")
```

URLs are not needed in my analysis, so I also strip all URLs from the text:

```r
brexit$text = gsub(' http[^[:blank:]]+', '', brexit$text)
```

Finally, since I only want to do analysis with original tweets, I make a subset for original tweets:

```r
orig = subset(brexit, !isRetweet)
```

## Calculating the emotional polarity

In order to sentimenal analysis, I use the function `polarity` in the `qdap` package. Note that `qdap` needs `rJava` to run, and in order to install `rJava`, your **Java** and **RStudio** need to be uniform (in either the 32-bit or 64-bit versions). 

The function `polarity` gives use a pretty comprehensive analysis in the polarity of the text (read more about the function [here](http://finzi.psych.upenn.edu/library/qdap/html/polarity.html)). However, in this case, I only need to use the polarity score of each tweet. 

```r
orig$pol = polarity(orig$text)$all$polarity #extracting the score
```

Positive tweets have positive polarity scores while negative tweets have negative polarity scores. The bigger one's absolute value is, the more positively/negatively polarized it is. Neutral/non-polarized tweets, which have no positive or negative words, have a polarity score of 0. 

To cross check, we look at the top negative tweets (with the lowest polarity scores) in the sample:

```r
orig$text[head(order(org$pol), n = 10)]
```

The results come out to be:

```r
 [1] "For many in the #UK, #Brexit means \"Fuck you, fuck the tories, fuck Cameron, fuck the power, fuck everything\". Sad, but true."         
 [2] "Fucking hell #Brexit"                                                                                                                    
 [3] "#Remain are confusing hatred with fear and #Brexit are just confused #EUreferendum #EUref"                                               
 [4] "A lot of #Brexit anxiety and really dumb #Brexit jokes on Twitter tonight.  Time to take a break."                                       
 [5] "Squeaky Bum Time! #brexit"                                                                                                               
 [6] "#GBPUSD down rapidly: about 5 cents in 30 mins.  pound sterling weakening. Very volatile movements. #Brexit #EUref"                      
 [7] "'Pot Kettle' methinks. #brexit The #incrowd seems to be full of vulgar insults allegations and hatred. https://t.co/eUhkVblYQ6"          
 [8] "So many warned that #Brexit would crash the economy but I guess fear of those bloody immigrants trumps everything. #thepoundfalls #EUref"
 [9] "Ed Miliband on BBC fails to condemn George Osborne's #brexit budget threat."                                                             
[10] "Its just sad sitting around waiting to see if 50%+1 of the UK population is really, really stupid. #Brexit #Remain"    
```

We can see that negative tweets are identified very accurately, as negative words and patterns are easy to spot. How about the positive ones?

```r
orig$text[head(order(-org$pol), n = 10)]
```

The results are:

```r
[1] "And if young Nigel says he's happy\nHe must be happy\nHe must be happy\nHe must be happy in his work\n\n#Brexit"
 [2] "Great result in Sunderland. Massive margin, very promising. I still have hope #EUref #Brexit"                   
 [3] "Well done #Swindon, another good win for #LeaveTheEU #InOrOut #Brexit"                                          
 [4] "#Brexit makes me really thankful for our Supreme Court, which could just go \"haha. No.\""                      
 [5] "Good luck #brexit supporters. Hope to see you reclaim your independence."                                       
 [6] "Good luck to #Brexit tonight!"                                                                                  
 [7] "FREEDOM WILL WIN TODAY!\n\n #Brexit"                                                                            
 [8] "@State_Control Good luck! #Brexit"                                                                              
 [9] "What I like best about UK? The gallows humour greeting possibility of #Brexit."                                 
[10] "Looks like #brexit is leading #bremain"                                                                         
```

As we can see, there are sarcastic tweets among genuinely happy tweets. The package is great at detecting happy tweets, but fails to detect sarcasm (which is inevitable, as sarcasm is hard to detect without contexts and relevant information).

As I have the polarity scores, I can proceed to calculate the proportion of positive, negative and neutral tweets in the sample:

```r
library(ggplot2)
library(scales)
ggplot(orig, aes(x = as.factor(polarity))) +
  geom_bar(aes(y = (..count..)/sum(..count..))) +
  geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust = -0.25) +
  scale_y_continuous(labels = percent) +
  labs(title = "The division in emotional polarity", y = "Percent", x = "Polarity")
```

The piece of code above gives us a nice bar graph on the proportion of emotional polarity in the sample, with 52.4% neutral tweets, 20.6% negative tweets, 27.1% positive (or sarcastic tweets).

![The division in emotional polarity](/images/Brexit-orig-pol.png)
